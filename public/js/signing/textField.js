define(["jquery","jqueryUI"],function(e){"use strict";e.widget("pp.textField",{_create:function(){this._getElements(),this._addListeners(),this._load()},_getElements:function(){this.elements={},this.elements.parent=this.element,this.elements.input=this.element.find("input"),this.elements.textarea=this.element.find("textarea"),this.elements.helpErrors=this.element.find(".help-error"),this.elements.parentInput=this.element.find(".errorMessage"),this.elements.submitError=this.element.find(".error-submit"),this.elements.emptyError=this.element.find(".error-empty"),this.elements.formatError=this.element.find(".error-format"),this.elements.customError=this.element.find(".error-custom"),this.elements.formatErrorSnils=this.element.find(".error-format-snils"),this.elements.formatErrorOms=this.element.find(".error-format-oms"),this.elements.formatErrorInn=this.element.find(".error-format-inn"),this.elements.invalidDateError=this.element.find(".error-invalid-date"),this.elements.invalidSSNError=this.element.find(".error-invalid-ssn"),this.elements.helpInformation=this.element.find(".help-information"),this.elements.emailExistsAjaxUsEn=this.element.find(".error-email-exists-ajax")},_addListeners:function(){this.elements.input.bind("focus",e.proxy(this._focus,this)),this.elements.input.bind("blur",e.proxy(this._blur,this)),this.elements.input.bind("keyup",e.proxy(this._keyup,this)),this.elements.input.bind("keypress",e.proxy(this._keyPress,this)),this.elements.textarea.bind("focus",e.proxy(this._focus,this)),this.elements.textarea.bind("blur",e.proxy(this._blur,this)),this.elements.textarea.bind("keyup",e.proxy(this._keyup,this)),this.isOem&&(this.elements.clearIcon.bind("click",e.proxy(this._clearClick,this)),this.elements.clearIcon.bind("mouseenter",e.proxy(this._clearMouseEnter,this)),this.elements.clearIcon.bind("mouseleave",e.proxy(this._clearMouseLeave,this))),this.elements.input.bind("complete",e.proxy(function(){this.closeBubble();var e=this.elements.input[0],t=this.validateField(e);t.valid?(this.elements.parent.removeClass("hasError"),this.elements.input.attr("aria-invalid","false")):(this.elements.parent.addClass("hasError"),this.elements.input.attr("aria-invalid","true"))},this)),this.elements.input.bind("error",e.proxy(this.openError,this))},_load:function(){this.elements.input.val()?this.elements.input.addClass("userText"):this.elements.input.removeClass("userText")},_blur:function(){this._load(),this.closeBubble();var t=this.elements.input[0];undefined===t&&undefined!==this.elements.textarea[0]&&(t=this.elements.textarea[0]);var n=this.validateField(t);e(t).val()===" "&&e(t).attr("required")&&(n={valid:!1,error:"pattern"}),this._emptyFieldRule(n),this.isOem&&(e(this).buttonToggle(),this.toggleClearIcon("blur",!1))},_keyPress:function(e){var t=e.target.value;!t.length>=1&&e.which===32&&e.preventDefault()},_keyup:function(e){if(e.which===9||e.which===16)return;this._load(),this.closeBubble(e)},_clearClick:function(){var t=this.elements.clearIcon[0].id.split("_")[0];t!==undefined&&(e("#"+t).val("").focus(),this.elements.parent.addClass("focus"))},_clearMouseEnter:function(){e(this.elements.clearIcon).addClass("hovered")},_clearMouseLeave:function(){e(this.elements.clearIcon).removeClass("hovered")},_emptyFieldRule:function(e){if(!e.valid){if(e.error==="valueMissing")this.elements.parent.removeClass("error-format"),this.elements.parent.addClass("hasError error-empty");else if(e.error==="patternMismatch"||e.error==="typeMismatch")this.elements.parent.removeClass("error-empty"),this.elements.parent.addClass("hasError error-format");this.elements.input.attr("aria-invalid","true")}else this.elements.parent.removeClass("hasError error-empty error-format"),this.elements.input.attr("aria-invalid","false")},_focus:function(t){var n=e(t.currentTarget);n.attr("display-tooltip")!=="always"&&this.closeAllBubble();var r=this.elements.parent.hasClass("hasError");r?this.openError():this.openHelp()},openError:function(){var e=this.elements.input.attr("id");e&&e.length>0&&this.elements.input.attr("aria-describedby",e+"-help-error"),this.elements.parent.hasClass("error-format")?(this.elements.parent.addClass("focus"),this.elements.parentInput.addClass("open"),this.elements.formatError.addClass("open")):this.elements.parent.hasClass("error-empty")?(this.elements.parent.addClass("focus"),this.elements.parentInput.addClass("open"),this.elements.emptyError.addClass("open")):this.elements.parent.hasClass("error-custom")?(this.elements.parent.addClass("focus"),this.elements.parentInput.addClass("open"),this.elements.customError.addClass("open")):this.elements.parent.hasClass("error-format-snils")?(this.elements.parent.addClass("focus"),this.elements.parentInput.addClass("open"),this.elements.formatErrorSnils.addClass("open")):this.elements.parent.hasClass("error-format-oms")?(this.elements.parent.addClass("focus"),this.elements.parentInput.addClass("open"),this.elements.formatErrorOms.addClass("open")):this.elements.parent.hasClass("error-format-inn")?(this.elements.parent.addClass("focus"),this.elements.parentInput.addClass("open"),this.elements.formatErrorInn.addClass("open")):this.elements.parent.hasClass("error-invalid-date")?(this.elements.parent.addClass("focus"),this.elements.parentInput.addClass("open"),this.elements.invalidDateError.addClass("open")):this.elements.parent.hasClass("error-invalid-ssn")?(this.elements.parent.addClass("focus"),this.elements.parentInput.addClass("open"),this.elements.invalidSSNError.addClass("open")):this.elements.parent.hasClass("error-email-exists-ajax")?(this.elements.parent.addClass("focus"),this.elements.parentInput.addClass("open"),this.elements.emailExistsAjaxUsEn.addClass("open")):(this.elements.parent.addClass("focus"),this.elements.parentInput.addClass("open"),this.elements.submitError.addClass("open"))},openHelp:function(){var e=this.elements.input.attr("id");e&&e.length>0&&this.elements.input.attr("aria-describedby",e+"-help-information"),this.elements.parent.addClass("focus"),this.elements.helpInformation.addClass("open")},closeBubble:function(){var e=this.elements.input.attr("id");e&&e.length>0&&this.elements.input.removeAttr("aria-describedby"),this.elements.helpErrors.removeClass("open"),this.elements.parent.removeClass("focus"),this.elements.parentInput.removeClass("open"),this.elements.helpInformation.removeClass("open")},closeAllBubble:function(){e("p.open, div.open").removeClass("open")},validateField:function(t){function n(n,r){return e(t).data().emailExistsAjaxError?!1:n}if(t.checkValidity){if(!t.checkValidity()){var r="";for(r in t.validity)if(t.validity[r]===!0&&r!=="valid")return{valid:n(!1),error:r}}}else{var i={valueMissing:this.processRequired(),typeMismatch:!0,patternMismatch:this.processPattern(),rangeUnderflow:!0,rangeOverflow:!0,customError:!0,invalidDateError:!0,invalidSSNError:!0};if(!i.valueMissing)return{valid:n(!1),error:"valueMissing"};if(!i.patternMismatch)return{valid:n(!1),error:"patternMismatch"}}return{valid:n(!0)}},processRequired:function(){if(typeof this.elements.input.attr("required")!="undefined"){var t=this.elements.input.val();return t!==null&&e.trim(t).length>0?!0:!1}return!0},processPattern:function(){var e=this.elements.input;if(!e.attr("pattern"))return!0;var t=new RegExp("^"+e.attr("pattern")+"$");return t.test(e.val())},toggleClearIcon:function(t,n){var r=this.elements.input.parent().hasClass("focus"),i=this.elements.input.siblings(".focus"),s=this.elements.input.siblings(".hovered");n&&(r||i)?(e(".clearIcon").addClass("hide"),this.elements.input.val()!==""?(this.elements.clearIcon.addClass("active"),this.elements.clearIcon.removeClass("empty")):(this.elements.clearIcon.addClass("empty"),this.elements.clearIcon.removeClass("active")),this.elements.clearIcon.removeClass("hide")):s.length||e(".clearIcon").addClass("hide")}})});